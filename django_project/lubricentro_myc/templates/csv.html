{% load static %}
{% csrf_token %}

{% include "encabezado.html" %}

{% block content %}

    <body>
        <div id="csv">
            
            <h1>Carga / Descarga Masiva</h1>

            <table class="operaciones" style="text-align: center">
                <tr class="exportar">
                    <td style="padding: 10px">
                        <select style="margin-bottom: 10px; width: 33%">
                            <option value="" disabled selected>- Modelo -</option>
                            <option value="clientes">Clientes</option>
                            <option value="productos">Productos</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <td style="padding: 10px"><button class="btn btn-default" onClick="exportar_csv()">Exportar CSV</button></td>
                </tr>
                <form action="/lubricentro_myc/importar_csv/" method="POST" enctype="multipart/form-data">
                    {% csrf_token %}
                    <tr class="importar">
                        <td style="padding: 10px">
                            <select style="margin-bottom: 10px; width: 33%" id="model" name="model">
                                <option value="" disabled selected>- Modelo -</option>
                                <option value="clientes">Clientes</option>
                                <option value="productos">Productos</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td style="padding: 10px"><input type="file" id="file" name="file" style="margin-left: 100px"></td>
                    </tr>
                    <tr>
                        <td style="padding: 10px"><button type="submit" class="btn btn-default">Importar CSV</button></td>
                    </tr>
                </form>
            </table>
        
        </div>

    </body>

    <script type="text/javascript">

        function exportar_csv(option) {
            model = $('.exportar select').val()
            if(model != null) {    
                axios({
                    method:'get',
                    url: `/lubricentro_myc/exportar_csv?model=` + model,
                    responseType: 'blob',
                }).then(response => {
                    const url = window.URL.createObjectURL(new Blob([response.data]));
                    const link = document.createElement('a');
                    link.href = url;
                    filename = model.charAt(0).toUpperCase() + model.slice(1) + '.csv'
                    link.setAttribute('download', filename);
                    document.body.appendChild(link);
                    link.click();
                }).catch(function (error) {
                    console.error(error);
                })
            } else {
                alert("Seleccione un modelo")
            }
        }

    </script>

{% endblock %}

{% include "footer.html" %}